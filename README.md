# 네이버 증권 목표주가 분석 크롤러 (Naver Stock Consensus Tracker)

이 프로젝트는 Node.js와 Puppeteer를 사용하여 네이버 증권에서 주식 종목의 목표주가(컨센서스), 현재가, 시가총액 등의 데이터를 수집하고, 사용자가 설정한 조건에 맞는 종목을 슬랙(Slack)으로 알림 보내주는 자동화 크롤러입니다.

## 주요 기능

- **데이터 수집**: 네이버 증권 모바일 페이지에서 특정 종목들의 주요 정보(종목명, 현재가, 목표주가, 시가총액)를 크롤링합니다.
- **조건부 필터링**: 사용자가 `.env` 파일에 설정한 '목표주가 대비 괴리율'과 '최소 시가총액' 기준을 모두 만족하는 종목만 선별합니다.
- **슬랙 알림**: 필터링된 종목 목록을 지정된 슬랙 채널로 전송합니다.
  - 괴리율이 낮은 순서(또는 높은 순서)로 정렬하여 전송합니다.
  - 메시지 가독성을 위해 색상 막대(Attachment)를 사용하며, 날짜(홀/짝)에 따라 색상이 변경됩니다.
  - 메시지는 20개씩 묶어서 전송됩니다.
- **자동 스케줄링**: `node-cron`을 사용하여 지정된 시간(예: 매일 아침 7시)에 크롤링 작업을 자동으로 실행합니다.
- **크롤링 최적화 (Skip List)**:
  - 목표주가가 없는 종목은 `skip-list.txt` 파일에 기록하여 다음 실행부터는 불필요한 크롤링을 건너뜁니다.
  - 매월 첫 번째 월요일에는 `skip-list.txt`를 초기화하여 모든 종목을 다시 점검합니다.
- **안정적인 운영**:
  - IP 차단을 피하기 위해 각 요청 사이에 임의의 지연 시간을 둡니다.
  - `pm2`와 같은 프로세스 매니저를 사용하여 백그라운드에서 안정적으로 실행할 수 있습니다.

## 사전 준비물

- Node.js (v18 이상 권장)
- npm

## 설치 및 설정

1.  **프로젝트 폴더 생성 및 파일 준비**
    이 프로젝트의 파일들(`index.js`, `package.json` 등)을 준비합니다.

2.  **의존성 라이브러리 설치**
    프로젝트 폴더 루트에서 아래 명령어를 실행합니다.
    ```bash
    npm install
    ```

3.  **`.env` 파일 생성 및 설정**
    프로젝트 루트에 `.env` 파일을 생성하고, 아래 예시를 참고하여 실제 값으로 채워넣습니다.

    ```.env
    # 크롤링할 주식 종목 코드 (쉼표로 구분)
    STOCK_CODES=005930,000660,035720,093370

    # Puppeteer 헤드리스 모드 설정 (true: 백그라운드 실행, false: 브라우저 창 표시)
    HEADLESS_MODE=true

    # 알림을 보낼 목표주가 대비 현재가의 최소 괴리율 (단위: %)
    PRICE_GAP_PERCENTAGE=20

    # 최소 시가총액 기준 (단위: 억)
    MIN_MARKET_CAP_BILLIONS=5000

    # Slack 봇 토큰 (xoxb- 로 시작하는 실제 토큰으로 교체)
    SLACK_TOKEN=xoxb-YOUR-SLACK-BOT-TOKEN

    # 메시지를 보낼 Slack 채널 ID (실제 채널 ID로 교체)
    SLACK_CHANNEL_ID=YOUR_CHANNEL_ID

    # Cron 스케줄 (기본값: 매일 아침 7시)
    CRON_SCHEDULE='0 7 * * *'
    ```

## 실행 방법

### 1. 개발 및 테스트 실행

터미널에서 아래 명령어를 실행하면 스크립트가 시작되고, `.env` 파일에 설정된 스케줄을 기다립니다.

```bash
npm start
```

> **참고**: 스크립트 시작 시 즉시 1회 실행하고 싶다면 `index.js` 파일 맨 아래의 `// scrapeStockData();` 주석을 해제하세요.

### 2. 프로덕션 환경 실행 (권장)

안정적인 백그라운드 실행 및 자동 재시작을 위해 `pm2`를 사용하는 것을 강력히 권장합니다.

1.  **pm2 설치 (최초 1회)**
    ```bash
    npm install pm2 -g
    ```

2.  **pm2로 크롤러 시작**
    ```bash
    pm2 start index.js --name "stock-crawler"
    ```

3.  **프로세스 상태 및 로그 확인**
    ```bash
    # 실행 중인 프로세스 목록 보기
    pm2 list

    # 실시간 로그 보기
    pm2 logs stock-crawler
    ```

## 주요 파일 구조

- **`index.js`**: 메인 크롤링 및 스케줄링 로직이 포함된 파일.
- **`package.json`**: 프로젝트 정보 및 의존성 라이브러리 목록.
- **`.env`**: 모든 주요 설정을 관리하는 환경 변수 파일.
- **`skip-list.txt`**: 목표주가가 없어 건너뛸 종목 코드가 자동으로 기록되는 파일.
- **`README.md`**: 프로젝트 설명 파일.